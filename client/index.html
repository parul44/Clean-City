<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="main.css">
    <title>Clean City</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" 
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
     integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
 integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" 
integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="main.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <script>
      fetch('/user/reports?limit=6&sortBy=createdAt:desc')
      .then(res => {
        res.json().then(data => {
          latest6 = document.getElementsByClassName("latest");
          for(i=0; i<6; i++){
            latest6[i].src=`/user/image/${data[i]._id}`
          }

          var flag=1;
          text6 = document.getElementsByClassName("text");
          var text6date = data.map(data=>data.createdAt.slice(0,10));
          
          
          window.setInterval(function() {
            for(i=0;i<6;i++){
              if(flag===1){
                text6[i].innerHTML = `Location: ${data[i].location} `
              }
              else if(flag===-1){
                text6[i].innerHTML = `Date Created: ${text6date[i]}`
              }
            }
            flag=flag*(-1);
          }, 2500);
          
        });
      }).catch();
      
    </script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      .mapcontainer{
        position: relative
      }

      #map {
        position: inherit;
        top: 0;
        bottom: 0;
        width: 100%;
        margin: auto;
        height: 100%;
      }

      #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
      }
      
      #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
      }
      
      #menu a:last-child {
        border: none;
      }
      
      #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
      }
      
      #menu a.active {
        background-color: #3887be;
        color: #ffffff;
      }
      
      #menu a.active:hover {
        background: #3074a4;
      }

      .item {
        position: relative;
        width: 100%;
      }

      .latest {
        opacity: 1;
        display: block;
        width: 100%;
        height: auto;
        backface-visibility: hidden;
      }

      .middle {
        border-radius: 20px;
        opacity: 0.7;
        width:75%;
        background-color: #dcf8f8;
        position: absolute;
        margin-bottom:5px;
        margin-left:5px;
        bottom: 0%;
        left: 0%;
      }

      .text {
        color: rgb(0, 0, 0);
        font-size: 15px;
        font-weight: bold;
        padding: 7px 15px;
      }
    </style>
</head>

<body>

    <header>
        <nav class="navbar navbar-expand-lg navbar-light " >
            
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
          
            <div class="collapse navbar-collapse" id="navbarSupportedContent" >
              <ul class="navbar-nav mr-auto">
                <li class="nav-item active ">
                  <a class="nav-link  " style="color:darkcyan;font-weight: 500;font-size:1.1em" href="#home">Home <span class="sr-only"></span></a>
                </li>
                <li class="nav-item active">
                  <a class="nav-link  " id="navupload" style="font-weight: 500;" href="form.html"> Upload Report</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link   " style="color:darkcyan;font-weight: 500;font-size:1.1em" href="#">About Us</a>
                  </li>
                
              </ul>
             </div>
            <form action="form.html">
</form>
          </nav>
    </header>
<br>
    <section id="home">
        <div id="carousel" data-interval="2000" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">
              <li data-target="#carousel"  data-slide-to="0" class="active"></li>
              <li data-target="#carousel"  data-slide-to="1"></li>
              <li data-target="#carousel" data-slide-to="2"></li>
            </ol>
            <div class="carousel-inner">
              <div class="carousel-item active" >
                <img src="images/slides/04.jpg" class="d-block w-100" alt="...">
              </div>
              <div class="carousel-item">
                <img src="images/slides/05.jpg" class="d-block w-100" alt="...">
              </div>
              <div class="carousel-item">
                <img src="images/slides/04.jpg" class="d-block w-100" alt="...">
              </div>
            </div>
            <a class="carousel-control-prev" href="#carousel" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carousel" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
      <br>
      <section id="heatmap">
      <br><br>
          <h4 style="text-align:center"> Live HeatMap of Polluted Areas</h4>
        <div class="mapcontainer">
        <nav id="menu"></nav>
        <div id='map'>
        <script>
          
          mapboxgl.accessToken = 'pk.eyJ1IjoiZXJyYWh1bDkzIiwiYSI6ImNqdW8wemlxODJwNzUzeXFqbnVibHZzYzUifQ.bZKWernpF2H1uvOVNp4DOA';
          var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [77.146721,28.644800],
            zoom: 11
          });

          var accidentJson, garbageJson;

          fetch('/user/geojson/Accident')
            .then(res=>{
              res.json().then(data=>{
                accidentJson=data
              })
            })

          fetch('/user/geojson/Garbage%20Heap')
          .then(res=>{
            res.json().then(data=>{
              garbageJson=data
            })
          })
          

          map.on('load', function() {
            //ACCIDENT
            map.addSource('Accident', {
            type: 'geojson',
            data: accidentJson
            });

            map.addLayer({
            id: 'Accident-heat',
            type: 'heatmap',
            source: 'Accident',
            maxzoom: 15,
            paint: {
              // increase weight as diameter breast height increases
              'heatmap-weight': {
                property: 'dbh',
                type: 'exponential',
                stops: [
                  [1, 0],
                  [62, 1]
                ]
              },
              // increase intensity as zoom level increases
              'heatmap-intensity': {
                stops: [
                  [11, 1],
                  [15, 3]
                ]
              },
              // assign color values be applied to points depending on their density
              'heatmap-color': [
                'interpolate',
                ['linear'],
                ['heatmap-density'],
                0, 'rgba(236,222,239,0)',
                0.2, 'rgb(208,209,230)',
                0.4, 'rgb(166,189,219)',
                0.6, 'rgb(103,169,207)',
                0.8, 'rgb(28,144,153)'
              ],
              // increase radius as zoom increases
              'heatmap-radius': {
                stops: [
                  [11, 15],
                  [15, 20]
                ]
              },
              // decrease opacity to transition into the circle layer
              'heatmap-opacity': {
                default: 1,
                stops: [
                  [14, 1],
                  [15, 0]
                ]
              },
            }
          }, 'waterway-label');
    
          map.addLayer({
            id: 'Accident-point',
            type: 'circle',
            source: 'Accident',
            minzoom: 14,
            paint: {
              // increase the radius of the circle as the zoom level and dbh value increases
              'circle-radius': {
                property: 'dbh',
                type: 'exponential',
                stops: [
                  [{ zoom: 15, value: 1 }, 5],
                  [{ zoom: 15, value: 62 }, 10],
                  [{ zoom: 22, value: 1 }, 20],
                  [{ zoom: 22, value: 62 }, 50],
                ]
              },
              'circle-color': {
                property: 'dbh',
                type: 'exponential',
                stops: [
                  [0, 'rgba(236,222,239,0)'],
                  [10, 'rgb(236,222,239)'],
                  [20, 'rgb(208,209,230)'],
                  [30, 'rgb(166,189,219)'],
                  [40, 'rgb(103,169,207)'],
                  [50, 'rgb(28,144,153)'],
                  [60, 'rgb(1,108,89)']
                ]
              },
              'circle-stroke-color': 'white',
              'circle-stroke-width': 1,
              'circle-opacity': {
                stops: [
                  [14, 0],
                  [15, 1]
                ]
              }
            }
          }, 'waterway-label');

          map.on('click', 'Accident-point', function(e) {
            new mapboxgl.Popup()
              .setLngLat(e.features[0].geometry.coordinates)
              .setHTML('<b>Accident:</b><br> '+ e.features[0].properties.brief.slice(0,33) + '<br>'
               + e.features[0].properties.brief.slice(33,66) + '<br>'
               + e.features[0].properties.brief.slice(66,100))
              .addTo(map);
          });
    
          //GARBAGE
          map.addSource('Garbage', {
          type: 'geojson',
          data: garbageJson
          });

          map.addLayer({
            id: 'Garbage-heat',
            type: 'heatmap',
            source: 'Garbage',
            maxzoom: 15,
            paint: {
              // increase weight as diameter breast height increases
              'heatmap-weight': {
                property: 'dbh',
                type: 'exponential',
                stops: [
                  [1, 0],
                  [62, 1]
                ]
              },
              // increase intensity as zoom level increases
              'heatmap-intensity': {
                stops: [
                  [11, 1],
                  [15, 3]
                ]
              },
              // assign color values be applied to points depending on their density
              'heatmap-color': [
                'interpolate',
                ['linear'],
                ['heatmap-density'],
                0, "rgba(33,102,172,0)",
                0.2, "rgb(103,169,207)",
                0.4, "rgb(209,229,240)",
                0.6, "rgb(253,219,199)",
                0.8, "rgb(239,138,98)",
                1, "rgb(178,24,43)"
              ],
              // increase radius as zoom increases
              'heatmap-radius': {
                stops: [
                  [11, 15],
                  [15, 20]
                ]
              },
              // decrease opacity to transition into the circle layer
              'heatmap-opacity': {
                default: 1,
                stops: [
                  [14, 1],
                  [15, 0]
                ]
              },
            }
          }, 'waterway-label');
    
          map.addLayer({
            id: 'Garbage-point',
            type: 'circle',
            source: 'Garbage',
            minzoom: 14,
            paint: {
              // increase the radius of the circle as the zoom level and dbh value increases
              'circle-radius': {
                property: 'dbh',
                type: 'exponential',
                stops: [
                  [{ zoom: 15, value: 1 }, 5],
                  [{ zoom: 15, value: 62 }, 10],
                  [{ zoom: 22, value: 1 }, 20],
                  [{ zoom: 22, value: 62 }, 50],
                ]
              },
              'circle-color': {
                property: 'dbh',
                type: 'exponential',
                stops: [
                  [0, 'rgba(236,222,239,0)'],
                  [10, 'rgb(236,222,239)'],
                  [20, 'rgb(208,209,230)'],
                  [30, 'rgb(166,189,219)'],
                  [40, 'rgb(103,169,207)'],
                  [50, 'rgb(28,144,153)'],
                  [60, 'rgb(1,108,89)']
                ]
              },
              'circle-stroke-color': 'white',
              'circle-stroke-width': 1,
              'circle-opacity': {
                stops: [
                  [14, 0],
                  [15, 1]
                ]
              }
            }
          }, 'waterway-label');

          map.on('click', 'Garbage-point', function(e) {
            new mapboxgl.Popup()
              .setLngLat(e.features[0].geometry.coordinates)
              .setHTML('<b>Garbage:</b><br> '+ e.features[0].properties.brief.slice(0,33) + '<br>'
               + e.features[0].properties.brief.slice(33,66) + '<br>'
               + e.features[0].properties.brief.slice(66,100))
              
              .addTo(map);
          });
          

          //SAMPLE
          map.addSource('Sample', {
              type: 'geojson',
              data: 'sampleJson.geojson'
              });
  
              map.addLayer({
              id: 'Sample-heat',
              type: 'heatmap',
              source: 'Sample',
              maxzoom: 15,
              paint: {
                // increase weight as diameter breast height increases
                'heatmap-weight': {
                  property: 'dbh',
                  type: 'exponential',
                  stops: [
                    [1, 0],
                    [62, 1]
                  ]
                },
                // increase intensity as zoom level increases
                'heatmap-intensity': {
                  stops: [
                    [11, 1],
                    [15, 3]
                  ]
                },
                // assign color values be applied to points depending on their density
                'heatmap-color': [
                  'interpolate',
                  ['linear'],
                  ['heatmap-density'],
                  0, "rgba(33,102,172,0)",
                  0.2, "rgb(103,169,207)",
                  0.4, "rgb(209,229,240)",
                  0.6, "rgb(253,219,199)",
                  0.8, "rgb(239,138,98)",
                  1, "rgb(178,24,43)"
                ],
                // increase radius as zoom increases
                'heatmap-radius': {
                  stops: [
                    [11, 15],
                    [15, 20]
                  ]
                },
                // decrease opacity to transition into the circle layer
                'heatmap-opacity': {
                  default: 1,
                  stops: [
                    [14, 1],
                    [15, 0]
                  ]
                },
              }
            }, 'waterway-label');
      
            map.addLayer({
              id: 'Sample-point',
              type: 'circle',
              source: 'Sample',
              minzoom: 14,
              paint: {
                // increase the radius of the circle as the zoom level and dbh value increases
                'circle-radius': {
                  property: 'dbh',
                  type: 'exponential',
                  stops: [
                    [{ zoom: 15, value: 1 }, 5],
                    [{ zoom: 15, value: 62 }, 10],
                    [{ zoom: 22, value: 1 }, 20],
                    [{ zoom: 22, value: 62 }, 50],
                  ]
                },
                'circle-color': {
                  property: 'dbh',
                  type: 'exponential',
                  stops: [
                    [0, 'rgba(236,222,239,0)'],
                    [10, 'rgb(236,222,239)'],
                    [20, 'rgb(208,209,230)'],
                    [30, 'rgb(166,189,219)'],
                    [40, 'rgb(103,169,207)'],
                    [50, 'rgb(28,144,153)'],
                    [60, 'rgb(1,108,89)']
                  ]
                },
                'circle-stroke-color': 'white',
                'circle-stroke-width': 1,
                'circle-opacity': {
                  stops: [
                    [14, 0],
                    [15, 1]
                  ]
                }
              }
            }, 'waterway-label');
  
            map.on('click', 'Sample-point', function(e) {
              new mapboxgl.Popup()
                .setLngLat(e.features[0].geometry.coordinates)
                .setHTML('<b>SAMPLE:</b><br>')
                .addTo(map);
            });
        }); 

        var toggleableLayerIds = [ 'Sample-heat','Garbage-heat', 'Accident-heat' ];
 
        for (var i = 0; i < toggleableLayerIds.length; i++) {
          var id = toggleableLayerIds[i];
            
          var link = document.createElement('a');
          link.href = '#';
          link.className = 'active';
          link.textContent = id;
            
          link.onclick = function (e) {
            var clickedLayer = this.textContent;
            e.preventDefault();
            e.stopPropagation();
              
            var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
              
            if (visibility === 'visible') {
              map.setLayoutProperty(clickedLayer, 'visibility', 'none');
              this.className = '';
            } else {
              this.className = 'active';
              map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
            }
          };
            
          var layers = document.getElementById('menu');
          layers.appendChild(link);
        }
                
        
        </script></div>
        
      </div>
      <br><br><br>
  </section>
<br><br><br>

  <h4 style="text-align:center;color:darkcyan">Latest Updates</h4>
      <div class="gallery">
        <div class="item">
          <img src="" class="latest">
          <div class="middle">
            <div class="text">No data</div>
          </div>
       </div>

        <div class="item">
                <img src="" class="latest">
                <div class="middle">
                  <div class="text">No data</div>
                </div>
        </div>
            <div class="item">
                    <img src="" class="latest">
                    <div class="middle">
                      <div class="text">No data</div>
                    </div>
            </div>
            <div class="item">
              <img src="" class="latest">
              <div class="middle">
                <div class="text">No data</div>
              </div>
           </div>
           <div class="item">
                   <img src="" class="latest">
                   <div class="middle">
                    <div class="text">No data</div>
                  </div>
           </div>
               <div class="item">
                       <img src="" class="latest">
                       <div class="middle">
                        <div class="text">No data</div>
                      </div>
               </div>
    </div>


            <div class="card-group text-center iconimg">
                <div class="card border border-info">
                  <img class="card-img-top" src="images/garbage.jpg" alt="Card image cap">
                  <div class="card-body">
                      <h4>Garbage</h4>
                      <p>Garbage reports </p>
                      <button type="button" class="btn btn-secondary" onclick='window.location = "garbage.html"' >View Reports</button> </div>
                </div>
                <div class="card border border-info">
                  <img class="card-img-top" src="images/electricity.jpg" alt="Card image cap">
                  <div class="card-body">
                      <h4>Electricity</h4>
                      <p>Cutoff reports </p>
                      <button type="button" class="btn btn-secondary" onclick='window.location = "electricity.html"'>View Reports</button></div>
                </div>
                <div class="card border border-info">
                  <img class="card-img-top" src="images/water.jpg" alt="Card image cap">
                  <div class="card-body">
                      <h4>Water</h4>
                      <p>Water reports </p>
                      <button type="button" class="btn btn-secondary" onclick='window.location = "water.html"'>View Reports</button>
                      </div>
                </div>
                <div class="card border border-info">
                    <img class="card-img-top" src="images/accident.jpg" alt="Card image cap">
                    <div class="card-body">
                        <h4>Accidents</h4>
                        <p>Accident reports </p>
                        <button type="button" class="btn btn-secondary" onclick='window.location = "accident.html"'>View Reports</button>
                     </div>
                  </div><div class="card border border-info">
                      <img class="card-img-top" src="images/crime.jpg" alt="Card image cap">
                      <div class="card-body">
                        <h4>Crime</h4>
                           <p>Crime reports </p>
                           <button type="button" class="btn btn-secondary" onclick='window.location = "crime.html"'>View Reports</button>
                 </div>
                    </div>
              </div>

    </section>
    <br><br><br>
    
    <footer class="footer-distributed">

      <div class="footer-left">

        <h3>Develop<span>HowTo</span></h3>

        <p class="footer-links">
          
          <a href="#">Garbage</a>
          路
          <a href="#">Electricity</a>
          路
          <a href="#">Water</a>
          路
          <a href="#">Accidents</a>
          路
          <a href="#">Crime</a>
        </p>

        <p class="footer-company-name">All Rights Reserved &copy; 2019</p>
        <br>
        <p class="footer-company-name">Made with Love in India</p>
      </div>

      <div class="footer-center">

        <div>
          <i class="fa fa-map-marker"></i>
          <p><span>Address line 1</span> Address line 2</p>
        </div>

        <div>
          <i class="fa fa-phone"></i>
          <p>phone number </p>
        </div>

        <div>
          <i class="fa fa-envelope"></i>
          <p><a href="https://develophowto.com/">https://develophowto.com/</a></p>
        </div>

      </div>

      <div class="footer-right">

        <p class="footer-company-about">
          <span>About the company</span>
          We deal with all type of issues.You cn lodge your complaints here.Join us to make everyone aware
        </p>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <div class="footer-icons">

          <a href="https://www.facebook.com" ><i class="fa fa-1x fa-facebook-square "></i></a>
          <a href="https://www.twitter.com" ><i class="fa fa-1x fa-twitter-square"></i></a>
          <a href="https://www.linkedin.com"><i class="fa fa-linkedin"></i></a>
          <a href="https://www.google.com" ><i class="fa fa-1x fa-google-plus"></i></a>

        </div>

      </div>

    </footer>
  </body>
  
</body>
</html>
